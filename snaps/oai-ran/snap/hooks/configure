#!/bin/sh
set -e 

snapctl stop --disable ${SNAP_NAME}  2>&1  || true
sleep 1 
snapctl start --enable ${SNAP_NAME}.apid  2>&1  || true

enb="$(snapctl get conf.enb)"
if [ ! -z "$enb" ] ; then 
    $SNAP/conf set-enb $enb
fi

cudu="$(snapctl get conf.cudu)"
if [ ! -z "$cudu" ] ; then 
    $SNAP/conf set-cudu $cudu
fi

rru="$(snapctl get conf.rru)"
if [ ! -z "$rru" ] ; then 
    $SNAP/conf set-rru $rru
fi

apiport=$(snapctl get conf.apiport)
if [ ! -z "$apiport" ] ; then 
    snapctl set conf.apiport=$apiport
fi

mgrport=$(snapctl get conf.mgrport)
if [ ! -z "$mgrport" ] ; then 
    snapctl set conf.apiport=$mgrport
fi

usrp=$(snapctl get conf.usrp)
if [ -z "$usrp" ] ; then
    snapctl set conf.usrp=UHD_IMAGES_DIR=$SNAP/uhd_images
fi

rfnoc=$(snapctl get conf.rfnoc)
if [ -z "$rfnoc" ] ; then
    snapctl set conf.rfnoc=UHD_RFNOC_DIR=$SNAP/usr/share/uhd/rfnoc/blocks
fi
